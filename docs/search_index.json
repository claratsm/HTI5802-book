[["index.html", "Algorithms in Bioinformatics and Genomics Welcome", " Algorithms in Bioinformatics and Genomics Clara Tang 2025-02-14 Welcome Welcome to the book for practical sections of HTI5802: Algorithms in Bioinformatics and Genomics. Most contents are demonstrated with PLINK and R programming language. This book is designed as a collection of R Markdown notebooks, as supplementary to the lecture notes for GWAS and sequence interpretation of HTI5802 at PolyU. Genomewide association analysis (GWAS) (2025-02-17) Variant interpretation for clinical sequencing (2025-03-10) Note: Most contents may be updated before or right after the lectures, so please refer to the updated version. GitHub Repository: you can find the source files on claratsm/HTI5802-book and the way to re-build this book. "],["genomewide-association-analysis-gwas.html", "Chapter 1 Genomewide association analysis (GWAS) 1.1 Objectives 1.2 Prerequisites 1.3 Step 0: Download the genotype data 1.4 Genotype Data format 1.5 Sample-QC 1.6 Why do we need the QC on GWAS data? 1.7 The QC protocol: from Sample QC to Variant QC 1.8 Step 2: Individuals with sex discrepancy 1.9 Step 3: Individuals with outlying heterozygosity rate 1.10 Step 4: Duplicated or related individuals 1.11 Step 5: Population outliers 1.12 Variant-QC 1.13 Association analysis 1.14 Step 1: Examining the phenotype file 1.15 Step 2: Performing association analysis", " Chapter 1 Genomewide association analysis (GWAS) 1.1 Objectives In this practical, you will learn the basic steps of data quality assessment and QC on genotype data that are typically carried out in genome-wide association studies (GWAS). * Genotype Data format * Sample QC * Variant QC * Association analysis 1.2 Prerequisites For sample and variant QC, we need the following software that is pre-installed in the VM - PLINK1.9 beta for data management - R for visualization of different QC measures 1.3 Step 0: Download the genotype data First, create a new directory named gwas for this practical section mkdir ~/gwas cd ~/gwas Download all zip file under it to your current directory wget https://github.com/claratsm/HTI5802_Algorithms-in-Bioinformatics-and-Genomics/raw/main/Practical/gwas.tar.gz wget https://github.com/claratsm/HTI5802_Algorithms-in-Bioinformatics-and-Genomics/raw/main/Practical/1000gData.tar.gz tar -zxvf gwas.tar.gz tar -zxvf 1000gData.tar.gz Use ls to list the files in your current directory. You should get NINE files, including the two sets of PLINK binary genotype files (BED, BIM and FAM) - Now your current folder should contain these files &gt; ASA.1000G.to-update-name.snp &gt; chrAll.ASA.1000GP-All.bed &gt; chrAll.ASA.1000GP-All.bim &gt; chrAll.ASA.1000GP-All.fam &gt; chrAll.ASA.bed &gt; chrAll.ASA.bim &gt; chrAll.ASA.fam &gt; integrated_call_samples_v3.20130502.ALL.panel &gt; practical2.PCAplot.R &gt; practical3.manhattanPlot.R &gt; CAD_LDL.pheno 1.3.1 Dataset The dataset used in this practical was simuated from haplotypes of East Asian samples of the 1000 Genomes Project (Phase 3). SNPs included in the dataset reflect to those assayed in the Illumina Asian Screening array designed to maximize the genomic coverage for East Asian population. 1.4 Genotype Data format 1.4.1 - PLINK binary variant file (BIM) Let’s have a look at the variant BIM file head chrAll.ASA.bim BIM file stores the variant information and must contain as many markers as are in the BED file. It contains no header line and each line describes a single marker with 4 columns: Chromosome code (1-22, 23/X, 24/Y, 25/XY, 26/MT; ‘0’ indicates unknown) Variant identifier Position in morgans or centimorgans (safe to use dummy value of ‘0’) Base-pair coordinate (1-based) A1 allele (Default: minor allele) A2 allele (Default: major allele) :green_book: Q: How many SNPs are there? wc -l chrAll.ASA.bim :green_book: Q: Where are these SNPs located in? cut -f 1 chrAll.ASA.bim | sort | uniq -c 1.4.2 - PLINK binary pedigree file (FAM) Let’s have a look at the FAM file less -S chrAll.ASA.fam # type &#39;q&#39; to quit The FAM file is a white-space (space or tab) delimited file It has no header line, and one line per sample with 6 columns: Family ID (‘FID’) Individual ID(‘IID’) Within-family ID of father (‘0’ if father isn’t in dataset) Within-family ID of mother (‘0’ if mother isn’t in dataset) Sex (1=male; 2=female; 0=unknown) Phenotype (1=control, 2=case, -9 / 0=missing for case-control; numeric for quantitative trait) :green_book: Q: How many samples are there? wc chrAll.ASA.fam :green_book: Q: Any sample belongs to the same family? awk &#39;$3!=0 || $4!=0&#39; chrAll.ASA.fam 1.5 Sample-QC 1.6 Why do we need the QC on GWAS data? Suboptimal study design, poor sample quality, and errors in genotype calling can introduce systematic biases into GWAS, leading to spurious associations. A thorough QC can help us identify samples and variants that should be removed prior to association analysis to minimize false-positive and false-negative associations. Here we assume that the study design has been conducted appropriately and basic QC to genotypes (e.g. QC based on GenTrain score in Illumina GenomeStudio or rare SNPs calling using zCall) has been performed after clustering and calling from probe intensity data. 1.7 The QC protocol: from Sample QC to Variant QC The QC protocol for GWAS typically split into two broad categories, Sample QC and Variant QC. Sample QC is usually done prior to Variant QC in order to maximise the number of variants remained for association analysis. In this practical, we will investigate the + Missingness for samples and variants + Heterogeneity in terms of inbreeding coefficient for sex chromosomes and autosomes + Identify-by-descent (IBD) and coefficient of relationship (PI_hat) for relatedness assessment + Principal component analysis (PCA) for identification of population outliers + Hardy-weinberg equilibrium + ## Step 1: Individuals with excessive missing genotypes - Obtain profile of missingness per individual and per SNP ~/plink --bfile chrAll.ASA --missing --out chrAll.ASA.beforeQC This command generates two files, including .imiss for sample-based and .lmiss for variant-based missingness &gt; chrAll.ASA.beforeQC.imiss # per individual &gt; chrAll.ASA.beforeQC.lmiss # per variant For both files, the last three columns measure the missingness for each individual or variant &gt; N_MISS: Number of missing genotype call(s) &gt; N_GENO: Number of genotype call(s) &gt; F_MISS: Missing call rate 1.7.0.1 QC: Record the sample IDs with call rate &lt;= 0.98 for removal awk &#39;NR&gt;1 &amp;&amp; $6&gt;0.02 { print $1,$2 }&#39; chrAll.ASA.beforeQC.imiss &gt; to-remove.mind02.indiv cut -d&#39; &#39; -f 2 to-remove.mind02.indiv &gt; to-remove.mind02.iid Plot the distribution of missingness We can then use R script to generate histogram of missingness # ========================== R code ========================== # ----------------------------------------------------------# # (1) SAMPLE CALL RATE - threshold = 98% # # ----------------------------------------------------------# imiss &lt;- read.table(&quot;chrAll.ASA.beforeQC.imiss&quot;,h=T) head(imiss) summary(imiss$F_MISS) # Plot missingness across samples hist(imiss$F_MISS, freq=T, col=&quot;darkred&quot;, border =&quot;black&quot;, main=&quot;Sample Call Rate&quot;, xlab=&quot;F_MISS&quot;, ylab=&quot;Number of samples&quot;) # Plot missingness with altered y-axis for a zoom in view hist(imiss$F_MISS, breaks=seq(0,0.6,0.05), freq=T, col=&quot;darkred&quot;, border =&quot;black&quot;, main=&quot;Sample Call Rate&quot;, xlab=&quot;F_MISS&quot;, ylab=&quot;Number of samples&quot;,ylim=c(0,10)) # ============================================================ :closed_book: Q: Can you try to plot the right number of excluded samples? Try your own R codes Answer 1 #==== R ===== hist(imiss$F_MISS, breaks=seq(0,0.6,0.01), freq=T, col=&quot;darkred&quot;, border=&quot;black&quot;, main=&quot;Sample Call Rate&quot;, xlab=&quot;F_MISS&quot;, ylab=&quot;Number of samples&quot;, ylim=c(0,100)) abline(v=0.02, lwd=2, lty=2, col=&quot;darkblue&quot;) abline(v=0.01, lwd=2, lty=2, col=&quot;darkgreen&quot;) practical2 missing-hist3 Answer 2 #==== R ===== plot(sort(imiss$F_MISS), pch=20, col=&quot;darkred&quot;, main=&quot;Sample Call Rate&quot;, xlab=&quot;ASA samples&quot;, ylab=&quot;F_MISS&quot;) abline(h=0.02, lwd=2, lty=2, col=&quot;darkblue&quot;) abline(h=0.01, lwd=2, lty=2, col=&quot;darkgreen&quot;) practical2 missing-hist4 We typically remove samples and variants with high degree of missingness using less stringent threshold (e.g. missingness &gt; 5% or 10%) at early stages of the QC steps; however, to illustrate how bad calling related to different QC measures, we keep all samples till the end of the QC practical. 1.8 Step 2: Individuals with sex discrepancy Obtain missingness of chr X ~/plink --bfile chrAll.ASA --chr 23 --missing --out chrX.ASA.beforeQC Check sex ~/plink --bfile chrAll.ASA --check-sex --out chrX.ASA The function of --check-sex normally compares the sex assignments in the input pedigree file (PEDSEX) with inbreeding coefficients (F) imputed from SNPs on chromosome X. By default, the F estimates smaller than 0.2 yield female calls, and values larger than 0.8 yield male calls for SNPSEX. # ========================== R code ========================== sexcheck &lt;- read.table(&quot;chrX.ASA.sexcheck&quot;,h=T) head(sexcheck) # FID IID PEDSEX SNPSEX STATUS F # 1 id1_0211 id2_0211 2 2 OK -1.0180 # 2 id1_1202 id2_1202 2 0 PROBLEM 0.6545 # 3 id1_1130 id2_1130 2 2 OK -0.7449 # 4 id1_1064 id2_1064 2 2 OK -0.2048 # 5 id1_1109 id2_1109 2 0 PROBLEM 0.7954 # 6 id1_0108 id2_0108 2 0 PROBLEM 0.3521 mismatch &lt;- sexcheck[sexcheck$STATUS==&quot;PROBLEM&quot;,] colsex &lt;- c(&quot;darkblue&quot;,&quot;darkred&quot;) plot(sexcheck$F, col=colsex[sexcheck$PEDSEX], main=&quot;Sex check&quot;, pch=20, xlab=&quot;ASA samples&quot;, ylab=&quot;chrX Inbreeding coefficient (F)&quot;) points(row.names(mismatch),mismatch$F,pch=22,bg=&quot;green&quot;,col=&quot;black&quot;,lwd=2,cex=2) abline(h=0.2, lwd=2, lty=2, col=&quot;red&quot;) abline(h=0.8, lwd=2, lty=2, col=&quot;blue&quot;) legend(&quot;bottomright&quot;,c(&quot;Male PEDSEX&quot;,&quot;Female PEDSEX&quot;,&quot;sample with PROBELM&quot;), col=c(colsex,&quot;black&quot;),pt.bg=&quot;green&quot;, pch=c(20,20,22)) # ============================================================= practical2 sexcheck What is the relationship between missingness and inbreeeding coefficient for chrX? # ========================== R code ========================== imiss.X &lt;- read.table(&quot;chrX.ASA.beforeQC.imiss&quot;,h=T) sexcheck.imiss &lt;- merge(imiss.X, sexcheck, by=&quot;IID&quot;) mismatch.imiss &lt;- sexcheck.imiss[sexcheck.imiss$STATUS==&quot;PROBLEM&quot;,] plot(sexcheck.imiss$F_MISS, sexcheck.imiss$F, pch=20, col=colsex[sexcheck.imiss$PEDSEX], xlab=&quot;Number of missing genotypes on chrX&quot;, ylab=&quot;chrX Inbreeding coefficient (F)&quot;) points(mismatch.imiss$F_MISS, mismatch.imiss$F, pch=22, bg=&quot;green&quot;, col=&quot;black&quot;, lwd=2, cex=1.5) abline(h=0.2, lwd=2, lty=2, col=&quot;red&quot;) abline(h=0.8, lwd=2, lty=2, col=&quot;blue&quot;) legend(&quot;bottomleft&quot;, c(&quot;Male PEDSEX&quot;,&quot;Female PEDSEX&quot;,&quot;sample with PROBELM&quot;), col=c(colsex,&quot;black&quot;),pt.bg=&quot;green&quot;, pch=c(20,20,22)) # ============================================================= practical2 sexcheck-fmiss In addition to poor sample or genotyping quality, X chromosome aneuploidy, such as Turner syndrome (e.g. 45,X0) and Klinefelter syndrome (47, XXY), may lead to abnormal heterogenity. Missingness for SNPs on chr Y can be used to impute sex using --check-sex ycount [female max F] [male min F] [female max Y obs] [male min Y obs]. Before determining the minimum and maximum threshold of observed chrY variants, we can first set [female max Y obs] to maximum number of chrY variants and [male min Y obs] to 0 ~/plink --bfile chrAll.ASA --check-sex ycount 0.2 0.8 805 0 --out chrXY.ASA.without-ycount :closed_book: Q: Do the samples detected by sex discrepancy or abnormal heterogenity look like having X chromosome aneuploidy? Try your own PLINK / R codes ** 1 ** egrep PROBLEM chrXY.ASA.without-ycount.sexcheck # FID IID PEDSEX SNPSEX STATUS F YCOUNT # id1_1202 id2_1202 2 0 PROBLEM 0.65450 607 # id1_1109 id2_1109 2 0 PROBLEM 0.79540 636 # id1_0108 id2_0108 2 0 PROBLEM 0.35210 569 # CHSHet002 CHSHet002 1 0 PROBLEM 0.67790 804 # id1_300 id2_300 1 2 PROBLEM 0.03826 2 # id1_301 id2_301 2 1 PROBLEM 1.00000 799 # id1_500 id2_500 1 2 PROBLEM 0.01425 2 # id1_501 id2_501 2 1 PROBLEM 1.00000 805 ** 2 ** # ========================== R code ========================== sexcheck.XY &lt;- read.table(&quot;chrXY.ASA.without-ycount.sexcheck&quot;,h=T) mismatch.XY &lt;- sexcheck.XY[sexcheck.XY$STATUS==&quot;PROBLEM&quot;,] colsex &lt;- c(&quot;darkblue&quot;,&quot;darkred&quot;) plot(sexcheck.XY$YCOUNT, sexcheck.XY$F, pch=20, col=colsex[sexcheck.XY$PEDSEX], xlab=&quot;Number of non-missing genotypes on chrY&quot;, ylab=&quot;chrX Inbreeding coefficient (F)&quot;) points(mismatch.XY$YCOUNT, mismatch.XY$F, pch=22, bg=colsex[mismatch.XY$PEDSEX], col=&quot;white&quot;, lwd=1, cex=1.5) abline(h=0.2, lwd=2, lty=2, col=&quot;red&quot;) abline(h=0.8, lwd=2, lty=2, col=&quot;blue&quot;) # ============================================================= practical2 sexcheck-XY You can now rerun --check-sex with appropriate [female max Y obs] and [male min Y obs] thresholds, e.g. 100 and 700. Samples with abormal number of non-missing genotypes on chrY will be flagged as ambiguous in SNPSEX. ~/plink --bfile chrAll.ASA --check-sex ycount 0.2 0.8 100 700 --out chrXY.ASA.with-ycount egrep -h PROBLEM chrXY.ASA.without-ycount.sexcheck chrXY.ASA.with-ycount.sexcheck | sort | uniq -u :closed_book: Q: What is the most likely karyotype for the id2_669 sample? Answer The id2_669 individual is likely to have Turner syndrome with 45,X0 or 45,X karyotype. Copy number variation analysis on SNP array data is needed to confirm the number of copy of X chromosome. 1.8.0.1 QC: Record the sample IDs with sex discrepancy problem for removal awk &#39;$5==&quot;PROBLEM&quot;{ print $1,$2 }&#39; chrXY.ASA.with-ycount.sexcheck &gt; to-remove.sexmismatch.indiv 1.9 Step 3: Individuals with outlying heterozygosity rate To avoid bias by genotyping error of rare variants and linkage disequilibrium, we usually perform the heterogeneity check using only common variants (MAF&gt;=5%) and SNPs in strong LD - Filter out low frequency and rare variants with MAF cut-off of 5% ~/plink --bfile chrAll.ASA --autosome --maf 0.05 --make-bed --missing --out chr1-22.ASA.maf05 LD pruning using R-squared 0.1 ~/plink --bfile chr1-22.ASA.maf05 --indep-pairwise 200 50 0.1 --out chr1-22.ASA.maf05.pruning ~/plink --bfile chr1-22.ASA.maf05 --extract chr1-22.ASA.maf05.pruning.prune.in --make-bed --out chr1-22.ASA.maf05.pruned ~/plink --bfile chr1-22.ASA.maf05.pruned --het --out chr1-22.ASA.maf05.pruned # ========================== R code ========================== imiss.common &lt;- read.table(&quot;chr1-22.ASA.maf05.imiss&quot;,h=T) het.common.pruned &lt;- read.table(&quot;chr1-22.ASA.maf05.pruned.het&quot;,h=T) imiss.het &lt;- merge(imiss.common, het.common.pruned, by=&quot;IID&quot;) up3sd&lt;-mean(imiss.het$F)+3*sd(imiss.het$F) low3sd&lt;-mean(imiss.het$F)-3*sd(imiss.het$F) plot(imiss.het$F_MISS, imiss.het$F, pch=20, col=&quot;darkgrey&quot;, xlab=&quot;F_MISS&quot;,ylab=&quot;Inbreeding coefficient (F)&quot;) points(imiss.het$F_MISS[imiss.het$F&lt;low3sd], imiss.het$F[imiss.het$F&lt;low3sd], bg=&quot;blue&quot;, pch=21) points(imiss.het$F_MISS[imiss.het$F&gt;up3sd], imiss.het$F[imiss.het$F&gt;up3sd], bg=&quot;red&quot;, pch=21) abline(h=up3sd, col=&quot;red&quot;, lwd=2, lty=2) abline(h=low3sd, col=&quot;blue&quot;, lwd=2, lty=2) legend(&quot;bottomleft&quot;, c(&quot;Below 3SD&quot;,&quot;Above 3SD&quot;), pt.bg=c(&quot;blue&quot;,&quot;red&quot;), pch=21) # ============================================================= practical2 het-fmiss Samples with high missingness usually have abnormal number of heterozygous genotypes called (too many or too few). - Remove these samples with high missingness (call rate &lt; 0.98) and redo the heterogeneity check. Use 3 standard deviation (SD) as cut-off and record the samples with abnormally high or low heterogeneity to be removed. 1.9.0.1 QC: Record the sample IDs with abnormal heterogeneity (outside 3SD) for removal # ========================== R code ========================== imiss.het.mind02 &lt;- imiss.het[imiss.het$F_MISS&lt;0.02,] up3sd &lt;- mean(imiss.het.mind02$F)+3*sd(imiss.het.mind02$F) low3sd &lt;- mean(imiss.het.mind02$F)-3*sd(imiss.het.mind02$F) excl.up3SD &lt;- imiss.het.mind02[imiss.het.mind02$F&gt;up3sd,] excl.low3SD &lt;- imiss.het.mind02[imiss.het.mind02$F&lt;low3sd,] write.table(rbind(excl.up3SD,excl.low3SD)[,1:2], &quot;to-remove.het3D.indiv&quot;, quote=F, row.names=F, col.names=F) write.table(rbind(excl.up3SD,excl.low3SD)[,2], &quot;to-remove.het3D.iid&quot;, quote=F, row.names=F, col.names=F) # ============================================================= 1.10 Step 4: Duplicated or related individuals For case-control association analysis, we need to make sure that the samples are biologically unrelated. Usually, samples with second (PI_HAT&gt;0.25) or third degree (PI_HAT&gt;0.125) relatedness are removed. Obtain pair-wise IBD for relatedness checking ~/plink --bfile chr1-22.ASA.maf05.pruned --genome --out chr1-22.ASA.maf05.pruned.IBDcheck Check the IBD0, IBD1, IBD2 and PI_hat for samples with high missingness egrep -wf to-remove.mind02.iid chr1-22.ASA.maf05.pruned.IBDcheck.genome | sort --key 10 -gr | less Check the IBD0, IBD1, IBD2 and PI_hat for samples with abnormal heterogeneity egrep -wf to-remove.het3D.iid chr1-22.ASA.maf05.pruned.IBDcheck.genome | sort --key 10 -gr | less :closed_book: Q: Which sample(s) looks like having contamination? Answer CHSHet002 looks like contaminated sample with high heterogeneity. Check the IBD0, IBD1, IBD2 and PI_hat for other samples cat to-remove.*indiv | sort | uniq &gt; to-remove.QC_steps1to3.indiv cut -d&#39; &#39; -f 2 to-remove.QC_steps1to3.indiv &gt; to-remove.QC_steps1to3.iid egrep -wvf to-remove.QC_steps1to3.iid chr1-22.ASA.maf05.pruned.IBDcheck.genome | sort --key 10 -gr | less :closed_book: Q: How are the samples in CHSQUAD family related? Answer CHSQUAD is a quad with F1 being the father and M1 being the mother. C1 and C2 are siblings. For those pairs of sample estimated to be closer than second degree kinship (PI_HAT&gt;0.25), remove at least one sample (usually the one with lower call rate) per pair. cat > to-remove.related.indiv CHSQUAD C1 CHSQUAD C2 # the type \"Ctrl-D\" to quit 1.11 Step 5: Population outliers To validate the self-reported ethnicity and to ensure no population outlier, we merge the genotype data of unrelated samples with the 1000 Genomes Project reference panel and then perform principal component analysis (PCA) using PLINK. Remove samples with high missingness and related samples and merge with the 1000 Genomes Project data cat to-remove.mind02.indiv to-remove.related.indiv &gt; to-remove.mind02_related.indiv ~/plink --bfile chrAll.ASA --remove to-remove.mind02_related.indiv --update-name ASA.1000G.to-update-name.snp --make-bed --out chrAll.ASA.id-1000G.rm-mind02_related ~/plink --bfile chrAll.ASA.id-1000G.rm-mind02_related --bmerge chrAll.ASA.1000GP-All --make-bed --out merged.chrAll.ASA.1000G.rm-mind02_related Extract only common variants not violating Hardy-Weinberg equilibrium and perform pruning to remove SNPs in LD ~/plink --bfile merged.chrAll.ASA.1000G.rm-mind02_related \\ --maf 0.05 --hwe 1e-5 --geno 0.05 \\ --indep-pairwise 200 50 0.1 \\ --out merged.chrAll.ASA.1000G.rm-mind02_related Perform PCA on pruned dataset (PS: You can speed up this step by using more than 1 thread if your VM is setup with multiple processors) ~/plink --bfile merged.chrAll.ASA.1000G.rm-mind02_related \\ --extract merged.chrAll.ASA.1000G.rm-mind02_related.prune.in \\ --pca 3 \\ --out merged.chrAll.ASA.1000G.rm-mind02_related.pruned \\ --threads 1 Generate PCA plot Rscript practical2.PCAplot.R merged.chrAll.ASA.1000G.rm-mind02_related.pruned.eigenvec :closed_book: Q: Can you find the population outliers? :closed_book: Q: Can you relate the results of the PCA and heterogeneity analyses for these samples? Answer cut -d&#39; &#39; -f 2 chrAll.ASA.fam &gt; chrAll.ASA.iid awk &#39;$3&lt;0.015&#39; merged.chrAll.ASA.1000G.rm-mind02_related.pruned.eigenvec | egrep -f chrAll.ASA.iid cat to-remove.het3D.iid 1.11.0.1 QC: Combine all sample outliers’ files and remove these outliers to obtain a new PLINK file with samples passing QC cat to-remove.QC_steps1to3.indiv to-remove.related.indiv &gt; to-remove.QC_steps1to4.indiv ~/plink --bfile chrAll.ASA --remove to-remove.QC_steps1to4.indiv --make-bed --out chrAll.ASA.afterSampleQC Retry the PCA with removal of all samples not passing QC, including those failed heterogeneity tests in Steps 2 and 3 Try your own PLINK / R codes ~/plink --bfile chrAll.ASA.afterSampleQC --update-name ASA.1000G.to-update-name.snp --make-bed --out chrAll.ASA.id-1000G.afterSampleQC ~/plink --bfile chrAll.ASA.id-1000G.afterSampleQC --bmerge chrAll.ASA.1000GP-All --make-bed --out merged.chrAll.ASA.1000G.afterSampleQC ~/plink --bfile merged.chrAll.ASA.1000G.afterSampleQC \\ --maf 0.05 --hwe 1e-5 --geno 0.05 \\ --indep-pairwise 200 50 0.1 \\ --out merged.chrAll.ASA.1000G.afterSampleQC ~/plink --bfile merged.chrAll.ASA.1000G.afterSampleQC \\ --extract merged.chrAll.ASA.1000G.afterSampleQC.prune.in \\ --pca 3 \\ --out merged.chrAll.ASA.1000G.afterSampleQC.pruned \\ --threads 1 Rscript practical2.PCAplot.R merged.chrAll.ASA.1000G.afterSampleQC.pruned.eigenvec 1.12 Variant-QC It consists of (at least) three steps: Excluding variants with an excessive missing genotype Excluding variants violating Hardy-Weinberg equilibrium (HWE) Excluding variants with a low MAF The threshold used for filtering depends on sample and genotyping data quality, which vary from study to study. Variant QC should be done carefully as variants removed can be the disease causal variants in which the signals of association may not be completely recovered by imputation. Here we are using the following thresholds: + --geno 0.02 Call rate &lt;= 98% + --hwe 1e-4 HWE p &lt; 1x10-4 + --maf 0.01 MAF &gt;= 1% QC: We can combine all these variant QCs into one single PLINK command: ~/plink --bfile chrAll.ASA.afterSampleQC \\ --geno 0.02 \\ --hwe 1e-4 \\ --maf 0.01 \\ --make-bed \\ --out chrAll.ASA.afterSampleQC.afterVariantQC At the end, you will end up with a dataset of 992 samples and 480780 variants passing sample-based and variant-based QCs. 1.13 Association analysis 1.14 Step 1: Examining the phenotype file Besides the 6th column in PLINK .ped and .fam file, you can use another phenotype file via the command of --pheno [filename] in PLINK. First, let’s use R to examine the content of the CAD_LDL.pheno phenotype file :closed_book: Q1. How many cornoary artery disease (CAD) patients and controls are there in this dataset? Answer 496 cases and 496 controls # ========================== R code ========================== pheno &lt;- read.table(&quot;CAD_LDL.pheno&quot;,h=T) summary(pheno) table(pheno$CAD) # ============================================================ :closed_book: Q2. Is the low density lipoprotein (LDL) level normally distributed? Answer Yes. The LDL level is normally distributed and no further transformation is needed # ========================== R code ========================== # Plot the histogram to assess if the LDL level is normally distributed hist(pheno$LDL, freq=T, col=&quot;darkred&quot;, border =&quot;black&quot;, main=&quot;Distribution of LDL&quot;, xlab=&quot;LDL level&quot;, ylab=&quot;Number of samples&quot;) # Plot the QQ plot to assess if the LDL level is normally distributed qqnorm(pheno$LDL) qqline(pheno$LDL) # ============================================================ :closed_book: Q3. Is there any relationship between age, LDL level and CAD? Answer CAD patients are generally older than controls (P=2.6x10-43) and LDL level increases with age (P=0.005). # ========================== R code ========================== # Test if age is associated with LDL and CAD summary(glm(LDL ~ AGE, data=pheno)) summary(glm(CAD==2 ~ AGE, family=&quot;binomial&quot;, data=pheno)) by(pheno$AGE, pheno$CAD, summary) # ============================================================ 1.15 Step 2: Performing association analysis Next, we will use PLINK to perform association test 1.15.1 1. Perform linear regression WITHOUT adjusting for age to test for association with LDL ~/plink --bfile chrAll.ASA.afterSampleQC.afterVariantQC \\ --chr 1-22,X,XY \\ --pheno CAD_LDL.pheno \\ --pheno-name LDL \\ --linear --adjust \\ --out LDL By default, sex is automatically added as a covariate for all X chromosome SNPs but not anywhere else. The --adjust option generates an .adjusted file with basic multiple testing corrections (e.g. FDR) for the raw p-values. It also estimates the genomic control factor (lambda) from the data. :closed_book: Q1. Which SNP is the top SNP? Can you give the effect size and the confidence interval (CI)? Answers Answer 1: The top SNP is rs2075650 on chr19 with association p-value of 3.8x10-32 head -n 2 LDL.assoc.linear.adjusted Answer 2: SNP effect beta (95% CI) = -0.9111 (-1.057, -0.7652). You can add --ci 0.95 while running the regression test in PLINK or you can compute the 95% CI in R ~/plink --bfile chrAll.ASA.afterSampleQC.afterVariantQC \\ --snp rs2075650 \\ --pheno CAD_LDL.pheno --pheno-name LDL \\ --linear --ci 0.95 \\ --out LDL.topsnp # ========================== R code ========================== L95 &lt;- -0.9111-1.96*0.07448 L95 U95 &lt;- -0.9111+1.96*0.07448 U95 # ============================================================ :closed_book: Q2. What is the lamda? Does it indicate inflation of the association statistics? Answer lamda=1.00236. No inflation in summary statistics. Plot the manhattan plot to visualize the association results # Rscript practical3.manhattanPlot.R &lt;assoc_file&gt; &lt;outpu_prefix&gt; Rscript practical3.manhattanPlot.R LDL.assoc.linear manhattanPlot.LDL 1.15.2 2. Perform linear regression while adjusted for age To adjust for confounding factor(s), you can use --covar &lt;filename&gt; to specify the covariate file, i.e. CAD_LDL.pheno in this example. The covariate(s) used for adjustment is specified through --covar-name. ~/plink --bfile chrAll.ASA.afterSampleQC.afterVariantQC \\ --chr 1-22,X,XY \\ --pheno CAD_LDL.pheno \\ --pheno-name LDL \\ --covar CAD_LDL.pheno \\ --covar-name AGE \\ --hide-covar \\ --linear --adjust \\ --out LDL.adj-AGE Plot the association results without adjustment of age and compare it with the previous one without adjustment Rscript practical3.manhattanPlot.R LDL.adj-AGE.assoc.linear manhattanPlot.LDL.adj-AGE 1.15.3 3. Perform logistic regression with and without adjusting for age to test for association with CAD Without adjusting for age ~/plink --bfile chrAll.ASA.afterSampleQC.afterVariantQC \\ --chr 1-22,X,XY \\ --pheno CAD_LDL.pheno --pheno-name CAD \\ --logistic \\ --out CAD Adjusting for age ~/plink --bfile chrAll.ASA.afterSampleQC.afterVariantQC \\ --chr 1-22,X,XY \\ --pheno CAD_LDL.pheno --pheno-name CAD \\ --covar CAD_LDL.pheno --covar-name AGE --hide-covar \\ --logistic \\ --out CAD.adj-AGE Plot the manhattan plots to compare the difference Rscript practical3.manhattanPlot.R CAD.assoc.logistic manhattanPlot.CAD Rscript practical3.manhattanPlot.R CAD.adj-AGE.assoc.logistic manhattanPlot.CAD.adj-AGE 1.15.4 Step 3: Annotating the association findings 1.15.4.1 LocusZoom (https://statgen.github.io/localzoom/) LocalZoom is a tool for generating regional association plot via web browser or offline. For the web-based js version without uploading the summary statistics, a tabix-indexed tab-delimited text file is needed. If you are comfortable uploading your data to a server, you can consider using the my.locuszoom.org upload service with more custom function. Please noted that both the reference (Ref) and alternative (Alt) alleles are needed for visualizing the LD. For simplicity, we use A1 as the alternative allele and A2 as the reference allele here. You will usually flip to the reference strand and get the right Ref/Alt alleles after imputation. # (i) convert &quot;fixed width&quot; PLINK association result format to &quot;tab-delimited&quot; # (ii) add the A2 allele (specifying the right Ref and Alt alleles are needed for LD plot) awk &#39;BEGIN { OFS=&quot;\\t&quot;; a2[&quot;SNP&quot;]=&quot;A2&quot; } NR==FNR { a2[$2]=$6 } NR!=FNR { $4=$4&quot;\\t&quot;a2[$2]; if (FNR!=1) $2=$1&quot;:&quot;$3; print }&#39; \\ chrAll.ASA.afterSampleQC.afterVariantQC.bim \\ LDL.adj-AGE.assoc.linear | \\ bgzip &gt; LDL.adj-AGE.assoc.linear.forLocuszoom.gz # (iii) index the association file tabix -s 1 -b 3 -e 3 --skip-lines 1 -f LDL.adj-AGE.assoc.linear.forLocuszoom.gz First, make sure that GWAS and the right genome assembly are chosen, i.e. GRCh37 for this example dataset Click Add tab-indexed datafile &gt; Browse to add the LDL.adj-AGE.assoc.linear.forLocuszoom .gz and .gz.tbi files Choose GWAS scattered plot as Type Under Variant from columns &gt; Choose the major allele A2 as Ref allele and the minor allele A1 as the Alt allele Next &gt; Accept option &gt; Type rs2075650 in the box &gt; Go to the region Choose LD population: EAS You can also change the range of region to 19:45300000-45500000 for a zoom in view 1.15.4.2 FUMA (https://fuma.ctglab.nl/) You can also use the SNP2GENE function in FUMA (Functional Mapping and Annotation of Genome-Wide Association Studies) for annotating, prioritizing, and interpreting the GWAS results. The SNP2GENE function takes GWAS summary statistics as input, and provides functional annotation for all SNPs in genomic areas identified by lead SNPs. + SNP2GENE result for CAD + SNP2GENE result for LDL "],["cross.html", "Chapter 2 Cross-references 2.1 Chapters and sub-chapters 2.2 Captioned figures and tables", " Chapter 2 Cross-references Cross-references make it easier for your readers to find and link to elements in your book. 2.1 Chapters and sub-chapters There are two steps to cross-reference any heading: Label the heading: # Hello world {#nice-label}. Leave the label off if you like the automated heading generated based on your heading title: for example, # Hello world = # Hello world {#hello-world}. To label an un-numbered heading, use: # Hello world {-#nice-label} or {# Hello world .unnumbered}. Next, reference the labeled heading anywhere in the text using \\@ref(nice-label); for example, please see Chapter 2. If you prefer text as the link instead of a numbered reference use: any text you want can go here. 2.2 Captioned figures and tables Figures and tables with captions can also be cross-referenced from elsewhere in your book using \\@ref(fig:chunk-label) and \\@ref(tab:chunk-label), respectively. See Figure 2.1. par(mar = c(4, 4, .1, .1)) plot(pressure, type = &#39;b&#39;, pch = 19) Figure 2.1: Here is a nice figure! Don’t miss Table 2.1. knitr::kable( head(pressure, 10), caption = &#39;Here is a nice table!&#39;, booktabs = TRUE ) Table 2.1: Here is a nice table! temperature pressure 0 0.0002 20 0.0012 40 0.0060 60 0.0300 80 0.0900 100 0.2700 120 0.7500 140 1.8500 160 4.2000 180 8.8000 "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
